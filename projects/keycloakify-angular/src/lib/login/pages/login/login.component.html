@let realm = kcContext.realm;
@let social = kcContext.social;
@let usernameHidden = kcContext.usernameHidden;
@let auth = kcContext.auth;
@let messagesPerField = kcContext.messagesPerField;
@let url = kcContext.url;
@let login = kcContext.login;

<kc-login-template
  [displayInfo]="displayInfo"
  [bodyClassName]="bodyClassName()"
  [displayMessage]="displayMessage"
  [displayRequiredFields]="displayRequiredFields()"
  [documentTitle]="documentTitle()"
>
  <ng-container headerNode>
    {{ "loginAccountTitle" | msgStr }}
  </ng-container>
  <ng-container infoNode>
    <div id="kc-registration-container">
      <div id="kc-registration">
        <span>
          {{ "noAccount" | msgStr }}
          <a
            tabindex="8"
            [href]="url?.registrationUrl"
          >
            {{ "doRegister" | msgStr }}
          </a>
        </span>
      </div>
    </div>
  </ng-container>
  <ng-container socialProvidersNode>
    @if (!!realm?.password && !!social?.providers?.length) {
      <div
        id="kc-social-providers"
        [kcClass]="'kcFormSocialAccountSectionClass'"
      >
        <hr />
        <h2>{{ "identity-provider-login-label" | msgStr }}</h2>
        <ul
          [kcClass]="{
            kcFormSocialAccountListClass: true,
            kcFormSocialAccountListGridClass: (social?.providers?.length ?? 0) > 3,
          }"
        >
          @for (provider of social?.providers; track provider.alias; let idx = $index) {
            <li>
              <a
                [id]="provider.alias"
                [kcClass]="{
                  kcFormSocialAccountListButtonClass: true,
                  kcFormSocialAccountGridItem: (social?.providers?.length ?? 0) > 3,
                }"
                type="button"
                [href]="provider.loginUrl"
              >
                @if (provider.iconClasses) {
                  <i
                    [ngClass]="provider.iconClasses"
                    [kcClass]="'kcCommonLogoIdP'"
                    aria-hidden="true"
                  ></i>
                }
                <span
                  [ngClass]="{
                    'kc-social-icon-text': provider.iconClasses,
                  }"
                  [kcClass]="'kcFormSocialAccountNameClass'"
                  [innerHTML]="provider.displayName | kcSanitize: 'html'"
                ></span>
              </a>
            </li>
          }
        </ul>
      </div>
    }
  </ng-container>
  <ng-container content>
    <div id="kc-form">
      <div id="kc-form-wrapper">
        <!-- login.component.html -->
        @if (realm?.password) {
          <form
            id="kc-form-login"
            (onSubmit)="isLoginButtonDisabled.set(true)"
            [action]="url?.loginAction"
            method="post"
          >
            @if (!usernameHidden) {
              <div [kcClass]="'kcFormGroupClass'">
                <label
                  for="username"
                  [kcClass]="'kcLabelClass'"
                >
                  @if (!realm?.loginWithEmailAllowed) {
                    {{ "username" | msgStr }}
                  } @else if (!realm?.registrationEmailAsUsername) {
                    {{ "usernameOrEmail" | msgStr }}
                  } @else {
                    {{ "email" | msgStr }}
                  }
                </label>
                <input
                  tabindex="2"
                  id="username"
                  [kcClass]="'kcInputClass'"
                  name="username"
                  type="text"
                  autofocus
                  [defaultValue]="login?.username || ''"
                  [attr.aria-invalid]="messagesPerField?.existsError('username', 'password')"
                />
                @if (messagesPerField?.existsError('username', 'password')) {
                  <span
                    id="input-error"
                    [kcClass]="'kcInputErrorMessageClass'"
                    aria-live="polite"
                    [innerHTML]="messagesPerField?.getFirstError('username', 'password') | kcSanitize: 'html'"
                  >
                  </span>
                }
              </div>
            }

            <div [kcClass]="'kcFormGroupClass'">
              <label
                for="password"
                [kcClass]="'kcLabelClass'"
              >
                {{ "password" | msgStr }}
              </label>

              <kc-password-wrapper passwordInputId="password">
                <input
                  kcInput
                  tabindex="3"
                  id="password"
                  [kcClass]="'kcInputClass'"
                  name="password"
                  type="password"
                  autocomplete="off"
                  [attr.aria-invalid]="messagesPerField.existsError('username', 'password')"
                />
              </kc-password-wrapper>
              @if (usernameHidden && messagesPerField?.existsError('username', 'password')) {
                <span
                  id="input-error"
                  [kcClass]="'kcInputErrorMessageClass'"
                  aria-live="polite"
                  [innerHTML]="messagesPerField?.getFirstError('username', 'password') | kcSanitize: 'html'"
                >
                </span>
              }
            </div>

            <div [kcClass]="['kcFormGroupClass', 'kcFormSettingClass']">
              <div id="kc-form-options">
                @if (realm?.rememberMe && !usernameHidden) {
                  <div class="checkbox">
                    <label>
                      <input
                        tabindex="5"
                        id="rememberMe"
                        name="rememberMe"
                        type="checkbox"
                        [defaultChecked]="!!login?.rememberMe"
                      />
                      {{ "rememberMe" | msgStr }}
                    </label>
                  </div>
                }
              </div>

              <div [kcClass]="'kcFormOptionsWrapperClass'">
                @if (realm?.resetPasswordAllowed) {
                  <span>
                    <a
                      tabindex="6"
                      [href]="url?.loginResetCredentialsUrl"
                      >{{ 'doForgotPassword' | msgStr }}</a
                    >
                  </span>
                }
              </div>
            </div>
            <div
              id="kc-form-buttons"
              [kcClass]="'kcFormGroupClass'"
            >
              <input
                type="hidden"
                id="id-hidden-input"
                name="credentialId"
                [value]="auth?.selectedCredential"
              />
              <input
                tabindex="7"
                [kcClass]="['kcButtonClass', 'kcButtonPrimaryClass', 'kcButtonBlockClass', 'kcButtonLargeClass']"
                name="login"
                id="kc-login"
                type="submit"
                [value]="'doLogIn' | msgStr"
                [disabled]="isLoginButtonDisabled()"
              />
            </div>
          </form>
        }
      </div>
    </div>
  </ng-container>
</kc-login-template>
